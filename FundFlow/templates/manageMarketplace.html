{% extends 'base.html' %}

{% block content %}


<h1 id = "manage-org-title"> Manage {{thisOrg}} Marketplace</h1>


<div class ="manage-item-info-container"> 
    <a id="create-item-btn" href="{% url 'createitem' %}">
        <button class="create-item-btn-text" > + create item</button>
    </a> 

    <label id="manage-item-search">Search for item </label>
    <label id ="manage-filter-subtitle-label"> Keywords </label> 

    {% comment %} tags {% endcomment %}
    
    {% comment %} {% for tag in alltags %}
    {{alltags}}
    {% end for %} {% endcomment %}

    <label id = "filter-tags-label"> tagnamevari </label>

    <div class =  "double-slider-box">
        <label id = "manage-filter-subtitle-label"> Price </label> 
        <div class = "range-slider">
            <span class = "slider-track"> </span>
            <input type = "range" name="min_val" class = "min-val" min = "1000" max = "12000" value = "2000">
            <input type = "range" name="max_val" class = "max-val" min = "1000" max = "12000" value = "7000">
            <div class = "tooltip min-tooltip"> </div>
            <div class = "tooltip max-tooltip"> </div>
        </div>
        <div class = "input-box">
            <div class = "min-box">
                <div class = "input-wrap">
                    <span class = "input-addon">$</span>
                    <input type = "text" name = "min_input" class = "input-field min-input">
                </div>
            </div>

            <div class = "max-box">
                <div class = "input-wrap">
                    <span class = "input-addon">$</span>
                    <input type = "text" name = "max_input" class = "input-field max-input">
                </div>
            </div>
        </div>
    </div>




        {% comment %} Sort by {% endcomment %}



</div>

<div>
    <table class= "log-table">
        <thead>
            <tr>
                <th>Item Name</th>
                <th>Price</th>
                <th>Tags</th>
                <th>Quantity</th>
                <th>Image</th>
                <th> Delete Item </th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td>{{ item.item_name  }}</td>
                <td>{{ item.price }}</td>
                <td>
                    {% for tag in item.tags.all %}
                      {{ tag.name }}{% if not forloop.last %}, {% endif %}
                    {% empty %}
                      No tags
                    {% endfor %}
                </td>
                <td>{{ item.quantity }}</td>
                <td>
                    {% if item.image %}
                        <a href="#" class="image-link" data-image="{{ item.image.url }}">View image</a>
                    {% else %}
                        No image provided 
                    {% endif %}
                </td>
                <td><a href="{% url 'delete_item' item.id %}"> Delete </a></td>             
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

</div>
<!-- item image modal -->
<div id="itemModal" class="item">
    <div class="item-content">
        <span class="close">&times;</span>
        <div id="itemContainer">
            <!-- Receipt will be displayed here -->
        </div>
    </div>
</div>


<script>

    window.onload = function () {
        slideMin();
        slideMax();
      };
      
      const minVal = document.querySelector(".min-val");
      const maxVal = document.querySelector(".max-val");
      const priceInputMin = document.querySelector(".min-input");
      const priceInputMax = document.querySelector(".max-input");
      const minTooltip = document.querySelector(".min-tooltip");
      const maxTooltip = document.querySelector(".max-tooltip");
      const minGap = 1500;
      const range = document.querySelector(".slider-track");
      const sliderMinValue = parseInt(minVal.min);
      const sliderMaxValue = parseInt(maxVal.max);
      
      function slideMin() {
        let gap = parseInt(maxVal.value) - parseInt(minVal.value);
      }
      
      function slideMax() {
        let gap = parseInt(maxVal.value) - parseInt(minVal.value);
      }
      
      function setArea() {
        range.style.left = `${
          ((minVal.value - sliderMinValue) / (sliderMaxValue - sliderMinValue)) * 100
        }%`;
      
        range.style.left = (minVal.value / sliderMaxValue) * 100 + "%";
        minTooltip.style.left = (minVal.value / sliderMaxValue) * 100 + "%";
        range.style.right = `${
          100 -
          ((maxVal.value - sliderMinValue) / (sliderMaxValue - sliderMinValue)) * 100
        }%`;
        maxTooltip.style.right = 100 - (maxVal.value / sliderMaxValue) * 100 + "%";
      }
      
      function setMinInput() {
        let minPrice = parseInt(priceInputMin.value);
      }
      
      function setMaxInput() {
        let maxPrice = parseInt(priceInputMax.value);
      }


    document.addEventListener('DOMContentLoaded', function() {
        var modal = document.getElementById('itemModal');
        var container = document.getElementById('itemContainer');
        var span = document.getElementsByClassName('close')[0];
        var itemLinks = document.getElementsByClassName('image-link');
        
        // When the user clicks on a item link, open the modal
        for (var i = 0; i < itemLinks.length; i++) {
            itemLinks[i].addEventListener('click', function(event) {
                event.preventDefault();
                var itemUrl = this.getAttribute('data-image');
                
                // Check file type to determine how to display it
                if (itemUrl.toLowerCase().endsWith('.pdf')) {
                    container.innerHTML = '<iframe src="' + itemtUrl + '" width="100%" height="500px"></iframe>';
                } else {
                    container.innerHTML = '<img src="' + itemUrl + '" style="max-width:100%; max-height:80vh;">';
                }
                
                modal.style.display = 'block';
            });
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            modal.style.display = 'none';
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
    });
</script>

{%endblock%}

